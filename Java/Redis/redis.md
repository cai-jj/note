# Redis知识点

## 1.Redis数据结构

### 1.1 Redis数据结构

### 1.2 Redis数据类型

底层实现

应用场景

## 2. Redis如何保证持久化

AOF日志和RDB快照

### 2.1 AOF

每执行一条写命令，就会把命令写入AOF 文件里面

### 2.2 RDB

## 3.Redis 过期删除策略和内存淘汰策略

## 4. Redis事务

### 4.1 事务相关命令

`MULTI` 开启一个事务

`EXEC` 提交事务

`DISCARD` 取消一个事务块，清空事务队列，并恢复到正常执行模式

`WATCH` 监视一个或多个Key，以确保在事务执行期间这些Key的值没有发生变化，如果被监视的Key被修改，那么事务将被中断

`UNWATCH` 取消对所有Key的监视

### 4.2 事务的实现

1.事务开始

通过MULTI命令开启事务

2.命令入队

执行完MULTI命令后，后续的命令会被放入一个队列中，该队列是一个数组类型

3.事务执行

通过EXEC执行事务，执行队列中的所有命令

### 4.3 WATCH命令的实现

本质是一个乐观锁，监视一个或多个Key，以确保在事务执行期间这些Key的值没有发生变化，如果被监视的Key被修改，那么事务将被中断。

监视的数据都保存在一个watched\_keys字典里面，字典的值是一个链表，保存的是一个个被监视的客户端

当执行对数据库修改的命令之后，会调用touchWatchKey函数对watched\_keys字典进行检查，如果CAS标识打开，则拒绝提交事务

### 4.4 ACID特性

原子性：

命令加入队列保证全部执行，但不能保证全部执行成功(不支持回滚)

一致性：数据前后一致

事务可能出错的3个地方:

1.入队错误：拒绝执行入队错误的命令，保证数据一致性

2.执行错误：事务执行出错的命令不会对数据库造成任何修改，保证数据一致性

3.服务器宕机：无持久化和持久化都会保证数据一致性

隔离性：单线程执行事务

持久性：由Redis持有化功能决定(AOF和RDB)

AOF的always可以保证持久性，而erverysec和no不能保证

RDB不能保证
