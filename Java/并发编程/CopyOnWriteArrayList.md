CopyOnWriteArrayList

线程安全的ArrayList，写时复制策略。读操作不加锁，写操作（增删改）加锁（JDK1.8是使用ReentrantLock加锁）。

初始化

+ 无参初始化一个大小为0的Object数组。

读操作

+ 获取当前数组，再通过小标访问数组中的元素，两步操作
+ X线程根据索引0执行读取操作，Y线程根据索引0执行删除操作（发生在两步中间执行），X线程读取的到就是索引1的元素，如果索引1没有元素，则抛出异常。

写操作

+ add 
  + 当前线程获得锁，其他线程阻塞，获得当前数组，创建新的数组，将旧数组值拷贝到新数组，添加元素到新数组，新的数组替换旧的数组。

+ remove
  + 当前线程获得锁，其他线程阻塞，获得当前数组，创建新的数组，将旧数组值拷贝到新数组，删除元素，新的数组替换旧的数组。

+ set
  + 获取锁，创建新的数组，将旧数组的值拷贝到新数组，判断修改的数组的元素与新值是否一样，
    + 不一样，修改，array执向新的数组。
    + 一样，也需要让array指向新的数组。为了保证volatile

迭代器的弱一致性

+ 迭代器的数组array是快照版本